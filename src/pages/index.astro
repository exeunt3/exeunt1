---
import Base from "../layouts/Base.astro";

function slugify(s) {
  return String(s)
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
}

const modules = import.meta.glob("../content/essays/*.md", { eager: true });

const essays = Object.entries(modules)
  .map(([path, mod]) => {
    const file = path.replace(/^.*\/content\/essays\//, "").replace(/\.md$/, "");
    const fm = mod.frontmatter ?? {};
    const slug = slugify(file); // URL path
    return { slug, frontmatter: fm };
  })
  .filter((e) => !e.frontmatter.draft)
  .sort((a, b) => new Date(b.frontmatter.date) - new Date(a.frontmatter.date));
---

<Base title="Exeunt">
  <h1 class="hero-title">Essays</h1>
  <p class="intro"></p>

  <section class="essay-list">
    {essays.map(({ slug, frontmatter }) => (
      <article class="card">
        <div class="thumb">
          {frontmatter.banner && <img src={frontmatter.banner} alt="" loading="lazy" />}
        </div>
        <div class="meta">
          <div class="date">
            {new Date(frontmatter.date).toLocaleDateString(undefined, { year: "numeric", month: "short", day: "numeric" })}
          </div>
          <h2 class="title">
            <a href={`/essays/${slug}/`}>{frontmatter.title}</a>
          </h2>
          {frontmatter.summary && <div class="summary">{frontmatter.summary}</div>}
        </div>
      </article>
    ))}
  </section>
</Base>
